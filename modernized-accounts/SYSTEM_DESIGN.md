# System Design & Workflow - Modernized Accounts

## ğŸ“ Architecture Overview

### High-Level System Design

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    MODERNIZED ACCOUNTS SYSTEM                   â”‚
â”‚                  (Event-Driven Microservices)                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  USER/API CLIENT  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”‚ 1. Create Invoice Request
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      INVOICE SERVICE                            â”‚
â”‚  - Validates invoice data                                       â”‚
â”‚  - Generates unique invoice ID                                  â”‚
â”‚  - Calculates subtotal                                          â”‚
â”‚  - Stores invoice (in-memory)                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”‚ 2. Publish INVOICE_CREATED Event
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        EVENT BUS                                â”‚
â”‚  - Receives event from publisher                                â”‚
â”‚  - Routes event to all subscribers                              â”‚
â”‚  - Maintains event log                                          â”‚
â”‚  - Ensures loose coupling                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”‚ 3. Event Distribution (Parallel)
         â”‚
    â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                         â”‚                     â”‚
    â–¼                         â–¼                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   LEDGER     â”‚     â”‚     TAX      â”‚     â”‚   FUTURE     â”‚
â”‚   SERVICE    â”‚     â”‚   SERVICE    â”‚     â”‚   SERVICES   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”„ Complete Workflow

### Step-by-Step Flow Diagram

```
START
  â”‚
  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ STEP 1: INVOICE CREATION                                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Input:                                                     â”‚
â”‚  {                                                          â”‚
â”‚    "customer": "ACME Corporation",                          â”‚
â”‚    "items": [                                               â”‚
â”‚      {"description": "Services", "qty": 10, "rate": 500}    â”‚
â”‚    ]                                                        â”‚
â”‚  }                                                          â”‚
â”‚                                                             â”‚
â”‚  Invoice Service Actions:                                  â”‚
â”‚  âœ“ Validate customer name                                  â”‚
â”‚  âœ“ Validate items (qty > 0, rate >= 0)                     â”‚
â”‚  âœ“ Generate invoice ID: INV-20260117-ABC12                 â”‚
â”‚  âœ“ Calculate subtotal: $5,000.00                           â”‚
â”‚  âœ“ Set status: DRAFT                                       â”‚
â”‚  âœ“ Store invoice in memory                                 â”‚
â”‚                                                             â”‚
â”‚  Output:                                                    â”‚
â”‚  {                                                          â”‚
â”‚    "invoice_id": "INV-20260117-ABC12",                      â”‚
â”‚    "customer": "ACME Corporation",                          â”‚
â”‚    "subtotal": 5000.00,                                     â”‚
â”‚    "tax": 0.00,                                             â”‚
â”‚    "total": 5000.00,                                        â”‚
â”‚    "status": "DRAFT"                                        â”‚
â”‚  }                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  â”‚
  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ STEP 2: EVENT PUBLICATION                                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Invoice Service publishes event:                           â”‚
â”‚                                                             â”‚
â”‚  publish("INVOICE_CREATED", {invoice_data})                 â”‚
â”‚                                                             â”‚
â”‚  Event Bus Actions:                                         â”‚
â”‚  âœ“ Receives event from Invoice Service                     â”‚
â”‚  âœ“ Timestamps event: 2026-01-17T10:30:45.123456            â”‚
â”‚  âœ“ Logs event in event_log[]                               â”‚
â”‚  âœ“ Identifies subscribers: [Ledger, Tax]                   â”‚
â”‚  âœ“ Prepares to call all handlers                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  â”‚
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                         â”‚                       â”‚
  â–¼                         â–¼                       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  SUBSCRIBER  â”‚   â”‚  SUBSCRIBER  â”‚   â”‚  SUBSCRIBER  â”‚
â”‚      #1      â”‚   â”‚      #2      â”‚   â”‚      #3      â”‚
â”‚   LEDGER     â”‚   â”‚     TAX      â”‚   â”‚   (Future)   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  â”‚                         â”‚
  â–¼                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ STEP 3a: LEDGER SERVICE PROCESSING                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Ledger Consumer receives INVOICE_CREATED event             â”‚
â”‚                                                             â”‚
â”‚  Actions:                                                   â”‚
â”‚  âœ“ Extract invoice_id, customer, total                     â”‚
â”‚  âœ“ Create Accounts Receivable (AR) entry:                  â”‚
â”‚    - Account: "Accounts Receivable"                         â”‚
â”‚    - Type: Asset                                            â”‚
â”‚    - Debit: $5,000.00                                       â”‚
â”‚    - Credit: $0.00                                          â”‚
â”‚                                                             â”‚
â”‚  âœ“ Create Sales Revenue entry:                             â”‚
â”‚    - Account: "Sales Revenue"                               â”‚
â”‚    - Type: Income                                           â”‚
â”‚    - Debit: $0.00                                           â”‚
â”‚    - Credit: $5,000.00                                      â”‚
â”‚                                                             â”‚
â”‚  âœ“ Verify double-entry: Debit ($5,000) = Credit ($5,000)   â”‚
â”‚  âœ“ Update account balances                                 â”‚
â”‚  âœ“ Generate trial balance report                           â”‚
â”‚                                                             â”‚
â”‚  Result: General Ledger Updated âœ“                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ STEP 3b: TAX SERVICE PROCESSING (Parallel)                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Tax Consumer receives INVOICE_CREATED event                â”‚
â”‚                                                             â”‚
â”‚  Actions:                                                   â”‚
â”‚  âœ“ Extract invoice_id, items[], subtotal                   â”‚
â”‚                                                             â”‚
â”‚  âœ“ Analyze each line item:                                 â”‚
â”‚    Item 1: "Professional Services"                          â”‚
â”‚      - Subtotal: $5,000.00                                  â”‚
â”‚      - Classification: General (not luxury)                 â”‚
â”‚      - Tax Rate: 10% (GST)                                  â”‚
â”‚      - Tax Amount: $500.00                                  â”‚
â”‚                                                             â”‚
â”‚  âœ“ Calculate total tax: $500.00                            â”‚
â”‚  âœ“ Calculate total with tax: $5,500.00                     â”‚
â”‚  âœ“ Store tax calculation record                            â”‚
â”‚  âœ“ Generate tax breakdown report                           â”‚
â”‚                                                             â”‚
â”‚  Result: Tax Calculated âœ“                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  â”‚
  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ STEP 4: COMPLETION                                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  All services have processed the invoice:                   â”‚
â”‚                                                             â”‚
â”‚  âœ“ Invoice stored in Invoice Service                       â”‚
â”‚  âœ“ Ledger entries created in Ledger Service                â”‚
â”‚  âœ“ Tax calculated in Tax Service                           â”‚
â”‚  âœ“ Event logged in Event Bus                               â”‚
â”‚                                                             â”‚
â”‚  System State: CONSISTENT                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  â”‚
  â–¼
END
```

---

## ğŸ­ Sequence Diagram

### Invoice Creation Flow

```
User/API    Invoice Service    Event Bus    Ledger Service    Tax Service
   â”‚                â”‚               â”‚               â”‚                â”‚
   â”‚ Create Invoice â”‚               â”‚               â”‚                â”‚
   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚               â”‚               â”‚                â”‚
   â”‚                â”‚               â”‚               â”‚                â”‚
   â”‚                â”‚ Validate      â”‚               â”‚                â”‚
   â”‚                â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚               â”‚                â”‚
   â”‚                â”‚          â”‚    â”‚               â”‚                â”‚
   â”‚                â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚               â”‚                â”‚
   â”‚                â”‚               â”‚               â”‚                â”‚
   â”‚                â”‚ Generate ID   â”‚               â”‚                â”‚
   â”‚                â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚               â”‚                â”‚
   â”‚                â”‚          â”‚    â”‚               â”‚                â”‚
   â”‚                â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚               â”‚                â”‚
   â”‚                â”‚               â”‚               â”‚                â”‚
   â”‚                â”‚ Calculate     â”‚               â”‚                â”‚
   â”‚                â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚               â”‚                â”‚
   â”‚                â”‚          â”‚    â”‚               â”‚                â”‚
   â”‚                â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚               â”‚                â”‚
   â”‚                â”‚               â”‚               â”‚                â”‚
   â”‚                â”‚ Publish Event â”‚               â”‚                â”‚
   â”‚                â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚               â”‚                â”‚
   â”‚                â”‚               â”‚               â”‚                â”‚
   â”‚                â”‚               â”‚ Route to      â”‚                â”‚
   â”‚                â”‚               â”‚ Subscribers   â”‚                â”‚
   â”‚                â”‚               â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚                â”‚
   â”‚                â”‚               â”‚          â”‚    â”‚                â”‚
   â”‚                â”‚               â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚                â”‚
   â”‚                â”‚               â”‚               â”‚                â”‚
   â”‚                â”‚               â”‚ Notify Ledger â”‚                â”‚
   â”‚                â”‚               â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚                â”‚
   â”‚                â”‚               â”‚               â”‚                â”‚
   â”‚                â”‚               â”‚               â”‚ Update Ledger  â”‚
   â”‚                â”‚               â”‚               â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
   â”‚                â”‚               â”‚               â”‚          â”‚     â”‚
   â”‚                â”‚               â”‚               â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
   â”‚                â”‚               â”‚               â”‚                â”‚
   â”‚                â”‚               â”‚ Notify Tax    â”‚                â”‚
   â”‚                â”‚               â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚
   â”‚                â”‚               â”‚               â”‚                â”‚
   â”‚                â”‚               â”‚               â”‚      Calculate â”‚
   â”‚                â”‚               â”‚               â”‚      Tax       â”‚
   â”‚                â”‚               â”‚               â”‚      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
   â”‚                â”‚               â”‚               â”‚      â”‚         â”‚
   â”‚                â”‚               â”‚               â”‚      â””â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚
   â”‚                â”‚               â”‚               â”‚                â”‚
   â”‚   Invoice      â”‚               â”‚               â”‚                â”‚
   â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤               â”‚               â”‚                â”‚
   â”‚   Created      â”‚               â”‚               â”‚                â”‚
   â”‚                â”‚               â”‚               â”‚                â”‚
   â”‚                â”‚               â”‚     [All services processed]   â”‚
   â”‚                â”‚               â”‚               â”‚                â”‚
```

---

## ğŸ—ï¸ Component Architecture

### Service Details

#### 1. Invoice Service

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              INVOICE SERVICE                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                         â”‚
â”‚  ğŸ“‚ Files:                                              â”‚
â”‚  â”œâ”€â”€ invoice_logic.py    (Business Logic)              â”‚
â”‚  â”œâ”€â”€ events.py           (Event Constants)             â”‚
â”‚  â””â”€â”€ app.py             (Service Entry Point)          â”‚
â”‚                                                         â”‚
â”‚  ğŸ¯ Responsibilities:                                   â”‚
â”‚  â€¢ Create new invoices                                  â”‚
â”‚  â€¢ Validate invoice data                                â”‚
â”‚  â€¢ Generate unique invoice IDs                          â”‚
â”‚  â€¢ Calculate subtotals                                  â”‚
â”‚  â€¢ Store invoices (in-memory)                           â”‚
â”‚  â€¢ Publish INVOICE_CREATED events                       â”‚
â”‚                                                         â”‚
â”‚  ğŸ“¤ Events Published:                                   â”‚
â”‚  â€¢ INVOICE_CREATED                                      â”‚
â”‚  â€¢ INVOICE_UPDATED (future)                             â”‚
â”‚  â€¢ INVOICE_CANCELLED (future)                           â”‚
â”‚                                                         â”‚
â”‚  ğŸ“¥ Events Consumed:                                    â”‚
â”‚  â€¢ None (this is a producer)                            â”‚
â”‚                                                         â”‚
â”‚  ğŸ’¾ Data Storage:                                       â”‚
â”‚  â€¢ invoices_store = {} (in-memory dictionary)           â”‚
â”‚                                                         â”‚
â”‚  ğŸ”„ Data Flow:                                          â”‚
â”‚  Input â†’ Validation â†’ ID Generation â†’ Subtotal         â”‚
â”‚  Calculation â†’ Storage â†’ Event Publication              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### 2. Event Bus

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  EVENT BUS                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                         â”‚
â”‚  ğŸ“‚ Files:                                              â”‚
â”‚  â””â”€â”€ event_bus.py        (Event System Core)           â”‚
â”‚                                                         â”‚
â”‚  ğŸ¯ Responsibilities:                                   â”‚
â”‚  â€¢ Manage event subscriptions                           â”‚
â”‚  â€¢ Route events to subscribers                          â”‚
â”‚  â€¢ Maintain event log                                   â”‚
â”‚  â€¢ Ensure loose coupling between services               â”‚
â”‚  â€¢ Enable asynchronous communication                    â”‚
â”‚                                                         â”‚
â”‚  ğŸ”§ Core Functions:                                     â”‚
â”‚  â€¢ subscribe(event_name, handler)                       â”‚
â”‚  â€¢ publish(event_name, payload)                         â”‚
â”‚  â€¢ get_event_log()                                      â”‚
â”‚                                                         â”‚
â”‚  ğŸ’¾ Data Structures:                                    â”‚
â”‚  â€¢ _subscribers = {                                     â”‚
â”‚      "INVOICE_CREATED": [handler1, handler2],           â”‚
â”‚      "INVOICE_UPDATED": [handler3]                      â”‚
â”‚    }                                                    â”‚
â”‚  â€¢ _event_log = [                                       â”‚
â”‚      {"event": "...", "timestamp": "...", "payload": {}}â”‚
â”‚    ]                                                    â”‚
â”‚                                                         â”‚
â”‚  ğŸ”„ Flow:                                               â”‚
â”‚  Publisher â†’ publish() â†’ Route to Subscribers           â”‚
â”‚  â†’ Call all handlers â†’ Log event                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### 3. Ledger Service

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              LEDGER SERVICE                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                         â”‚
â”‚  ğŸ“‚ Files:                                              â”‚
â”‚  â”œâ”€â”€ ledger_logic.py     (Ledger Operations)           â”‚
â”‚  â”œâ”€â”€ consumers.py        (Event Handlers)              â”‚
â”‚  â””â”€â”€ app.py             (Service Entry Point)          â”‚
â”‚                                                         â”‚
â”‚  ğŸ¯ Responsibilities:                                   â”‚
â”‚  â€¢ Maintain general ledger                              â”‚
â”‚  â€¢ Create double-entry bookkeeping records              â”‚
â”‚  â€¢ Update account balances                              â”‚
â”‚  â€¢ Generate trial balance                               â”‚
â”‚  â€¢ Ensure accounting accuracy                           â”‚
â”‚                                                         â”‚
â”‚  ğŸ“¥ Events Consumed:                                    â”‚
â”‚  â€¢ INVOICE_CREATED â†’ Create AR + Revenue entries        â”‚
â”‚                                                         â”‚
â”‚  ğŸ“¤ Events Published:                                   â”‚
â”‚  â€¢ None (this is a consumer)                            â”‚
â”‚                                                         â”‚
â”‚  ğŸ’¾ Data Storage:                                       â”‚
â”‚  â€¢ ledger_entries = [] (all journal entries)            â”‚
â”‚  â€¢ account_balances = {} (current balances)             â”‚
â”‚                                                         â”‚
â”‚  ğŸ”„ Double-Entry Logic:                                 â”‚
â”‚  For every invoice:                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚
â”‚  â”‚ Debit:  Accounts Receivable      â”‚                  â”‚
â”‚  â”‚ Credit: Sales Revenue             â”‚                  â”‚
â”‚  â”‚ Balance: Debit = Credit âœ“         â”‚                  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚
â”‚                                                         â”‚
â”‚  ğŸ“Š Accounts Managed:                                   â”‚
â”‚  â€¢ Accounts Receivable (Asset)                          â”‚
â”‚  â€¢ Sales Revenue (Income)                               â”‚
â”‚  â€¢ (Future: More account types)                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### 4. Tax Service

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                TAX SERVICE                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                         â”‚
â”‚  ğŸ“‚ Files:                                              â”‚
â”‚  â”œâ”€â”€ tax_logic.py        (Tax Calculations)            â”‚
â”‚  â”œâ”€â”€ consumers.py        (Event Handlers)              â”‚
â”‚  â””â”€â”€ app.py             (Service Entry Point)          â”‚
â”‚                                                         â”‚
â”‚  ğŸ¯ Responsibilities:                                   â”‚
â”‚  â€¢ Calculate taxes on invoices                          â”‚
â”‚  â€¢ Apply tax rules and rates                            â”‚
â”‚  â€¢ Handle tax exemptions                                â”‚
â”‚  â€¢ Generate tax reports                                 â”‚
â”‚  â€¢ Classify items by tax category                       â”‚
â”‚                                                         â”‚
â”‚  ğŸ“¥ Events Consumed:                                    â”‚
â”‚  â€¢ INVOICE_CREATED â†’ Calculate taxes                    â”‚
â”‚                                                         â”‚
â”‚  ğŸ“¤ Events Published:                                   â”‚
â”‚  â€¢ None (this is a consumer)                            â”‚
â”‚                                                         â”‚
â”‚  ğŸ’¾ Data Storage:                                       â”‚
â”‚  â€¢ tax_calculations = [] (all tax records)              â”‚
â”‚                                                         â”‚
â”‚  ğŸ¯ Tax Rules:                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚
â”‚  â”‚ Luxury Items      â†’ 15% tax      â”‚                  â”‚
â”‚  â”‚ Goods & Services  â†’ 10% GST      â”‚                  â”‚
â”‚  â”‚ Basic Items       â†’ 5% tax       â”‚                  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚
â”‚                                                         â”‚
â”‚  ğŸ”„ Calculation Flow:                                   â”‚
â”‚  Receive Invoice â†’ Analyze Items â†’ Classify             â”‚
â”‚  â†’ Apply Tax Rates â†’ Calculate Itemized Taxes           â”‚
â”‚  â†’ Sum Total Tax â†’ Generate Report                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“Š Data Flow Diagram

### Invoice Data Transformation

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ STAGE 1: INPUT DATA                                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ {                                                            â”‚
â”‚   "customer": "ACME Corporation",                            â”‚
â”‚   "items": [                                                 â”‚
â”‚     {"description": "Services", "qty": 10, "rate": 500.00}   â”‚
â”‚   ],                                                         â”‚
â”‚   "due_date": "2026-02-28"                                   â”‚
â”‚ }                                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ STAGE 2: INVOICE SERVICE ENRICHMENT                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ {                                                            â”‚
â”‚   "invoice_id": "INV-20260117-ABC12",      [GENERATED]       â”‚
â”‚   "customer": "ACME Corporation",                            â”‚
â”‚   "items": [...],                                            â”‚
â”‚   "subtotal": 5000.00,                     [CALCULATED]      â”‚
â”‚   "tax": 0.00,                                               â”‚
â”‚   "total": 5000.00,                                          â”‚
â”‚   "status": "DRAFT",                       [ADDED]           â”‚
â”‚   "created_at": "2026-01-17T10:30:45",     [ADDED]           â”‚
â”‚   "updated_at": "2026-01-17T10:30:45"      [ADDED]           â”‚
â”‚ }                                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ STAGE 3: EVENT BUS WRAPPING                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ {                                                            â”‚
â”‚   "event": "INVOICE_CREATED",                                â”‚
â”‚   "timestamp": "2026-01-17T10:30:45.123456",                 â”‚
â”‚   "payload": {                                               â”‚
â”‚     [Full invoice data from Stage 2]                         â”‚
â”‚   }                                                          â”‚
â”‚ }                                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚                         â”‚
            â–¼                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ STAGE 4a: LEDGER     â”‚   â”‚ STAGE 4b: TAX        â”‚
â”‚ TRANSFORMATION       â”‚   â”‚ TRANSFORMATION       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Ledger Entries:      â”‚   â”‚ Tax Calculation:     â”‚
â”‚                      â”‚   â”‚                      â”‚
â”‚ Entry 1:             â”‚   â”‚ {                    â”‚
â”‚ {                    â”‚   â”‚   "tax_id": "...",   â”‚
â”‚   "entry_id": "...", â”‚   â”‚   "invoice_id": "...",â”‚
â”‚   "account": "AR",   â”‚   â”‚   "items_breakdown": [â”‚
â”‚   "debit": 5000.00,  â”‚   â”‚     {                â”‚
â”‚   "credit": 0.00     â”‚   â”‚       "description": â”‚
â”‚ }                    â”‚   â”‚       "tax": 500.00, â”‚
â”‚                      â”‚   â”‚       "tax_rate": 0.10â”‚
â”‚ Entry 2:             â”‚   â”‚     }                â”‚
â”‚ {                    â”‚   â”‚   ],                 â”‚
â”‚   "entry_id": "...", â”‚   â”‚   "total_tax": 500.00â”‚
â”‚   "account": "Rev",  â”‚   â”‚ }                    â”‚
â”‚   "debit": 0.00,     â”‚   â”‚                      â”‚
â”‚   "credit": 5000.00  â”‚   â”‚                      â”‚
â”‚ }                    â”‚   â”‚                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”— Service Dependencies

### Dependency Graph

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Invoice       â”‚  (No dependencies)
â”‚  Service       â”‚  - Independent service
â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜  - Can run standalone
        â”‚
        â”‚ depends on
        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Event Bus     â”‚  (Core infrastructure)
â”‚                â”‚  - Required by all services
â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜  - Central communication hub
        â”‚
        â”‚ required by
        â”‚
    â”Œâ”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                   â”‚
    â–¼                   â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Ledger    â”‚    â”‚    Tax     â”‚  (Event consumers)
â”‚  Service   â”‚    â”‚  Service   â”‚  - Depend on Event Bus
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  - Don't know about each other
```

### Coupling Analysis

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              COUPLING MATRIX                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚             â”‚ Invoice  â”‚Event Bus â”‚ Ledger   â”‚  Tax    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Invoice     â”‚    -     â”‚  Medium  â”‚  None    â”‚  None   â”‚
â”‚ Event Bus   â”‚   Low    â”‚    -     â”‚  Low     â”‚  Low    â”‚
â”‚ Ledger      â”‚   None   â”‚  Medium  â”‚    -     â”‚  None   â”‚
â”‚ Tax         â”‚   None   â”‚  Medium  â”‚  None    â”‚    -    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Legend:
- None:   No coupling (best)
- Low:    Loose coupling (good)
- Medium: Some coupling (acceptable)
- High:   Tight coupling (avoid)
```

---

## ğŸ¯ Event Types & Payloads

### Event Catalog

#### INVOICE_CREATED Event

```json
{
  "event_name": "INVOICE_CREATED",
  "description": "Published when a new invoice is created",
  "publisher": "Invoice Service",
  "subscribers": ["Ledger Service", "Tax Service"],
  
  "payload": {
    "invoice_id": "string (required)",
    "customer": "string (required)",
    "items": [
      {
        "description": "string (required)",
        "qty": "integer (required, > 0)",
        "rate": "float (required, >= 0)"
      }
    ],
    "subtotal": "float (calculated)",
    "tax": "float (initially 0)",
    "total": "float (calculated)",
    "due_date": "string (optional, YYYY-MM-DD)",
    "notes": "string (optional)",
    "status": "string (DRAFT|SUBMITTED|PAID)",
    "created_at": "string (ISO 8601 timestamp)",
    "updated_at": "string (ISO 8601 timestamp)"
  },
  
  "example": {
    "invoice_id": "INV-20260117-ABC12",
    "customer": "ACME Corporation",
    "items": [
      {
        "description": "Professional Services",
        "qty": 10,
        "rate": 500.00
      }
    ],
    "subtotal": 5000.00,
    "tax": 0.00,
    "total": 5000.00,
    "due_date": "2026-02-28",
    "status": "DRAFT",
    "created_at": "2026-01-17T10:30:45.123456"
  }
}
```

---

## âš¡ Performance Characteristics

### Time Complexity

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ OPERATION              â”‚ TIME COMPLEXITY â”‚ NOTES    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Create Invoice         â”‚ O(n)            â”‚ n=items  â”‚
â”‚ Publish Event          â”‚ O(1)            â”‚          â”‚
â”‚ Route to Subscribers   â”‚ O(m)            â”‚ m=subs   â”‚
â”‚ Update Ledger          â”‚ O(1)            â”‚          â”‚
â”‚ Calculate Tax          â”‚ O(n)            â”‚ n=items  â”‚
â”‚ Get Ledger Entries     â”‚ O(k)            â”‚ k=entriesâ”‚
â”‚ Get Trial Balance      â”‚ O(a)            â”‚ a=accts  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Scalability Considerations

```
Current (Prototype):
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ â€¢ In-memory storage                         â”‚
â”‚ â€¢ Single process                            â”‚
â”‚ â€¢ Synchronous event handling                â”‚
â”‚ â€¢ Limited to ~1000 invoices/sec             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Production (Future):
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ â€¢ Database storage (PostgreSQL)             â”‚
â”‚ â€¢ Multiple instances (horizontal scaling)   â”‚
â”‚ â€¢ Kafka/RabbitMQ (async, distributed)       â”‚
â”‚ â€¢ Load balancer                             â”‚
â”‚ â€¢ Can handle 10,000+ invoices/sec           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ›¡ï¸ Error Handling & Resilience

### Error Propagation

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ SCENARIO: Tax Service Fails                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                        â”‚
â”‚  Invoice Service                                       â”‚
â”‚       â”‚                                                â”‚
â”‚       â”‚ Creates invoice âœ“                              â”‚
â”‚       â”‚ Publishes event âœ“                              â”‚
â”‚       â–¼                                                â”‚
â”‚  Event Bus                                             â”‚
â”‚       â”‚                                                â”‚
â”‚       â”œâ”€â”€â”€â”€â”€â”€â–º Ledger Service âœ“ (Still processes)     â”‚
â”‚       â”‚                                                â”‚
â”‚       â””â”€â”€â”€â”€â”€â”€â–º Tax Service âœ— (Fails)                  â”‚
â”‚                                                        â”‚
â”‚  Result:                                               â”‚
â”‚  â€¢ Invoice still created âœ“                             â”‚
â”‚  â€¢ Ledger still updated âœ“                              â”‚
â”‚  â€¢ Tax calculation failed âœ—                            â”‚
â”‚  â€¢ System continues operating (partial failure)        â”‚
â”‚                                                        â”‚
â”‚  Recovery:                                             â”‚
â”‚  â€¢ Retry tax calculation                               â”‚
â”‚  â€¢ Manual tax entry                                    â”‚
â”‚  â€¢ Alert administrator                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”„ State Transitions

### Invoice Lifecycle

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  START  â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
     â”‚
     â”‚ create_invoice()
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”     submit_invoice()      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  DRAFT  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º â”‚ SUBMITTED â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜                            â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
     â”‚                                       â”‚
     â”‚ cancel_invoice()                      â”‚ receive_payment()
     â”‚                                       â”‚
     â–¼                                       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                          â”Œâ”€â”€â”€â”€â”€â”€â”
â”‚ CANCELLED â”‚                          â”‚ PAID â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                          â””â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“ˆ Monitoring & Observability

### Key Metrics to Track

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ METRIC                  â”‚ TYPE      â”‚ PURPOSE       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Invoices Created        â”‚ Counter   â”‚ Volume        â”‚
â”‚ Events Published        â”‚ Counter   â”‚ Activity      â”‚
â”‚ Event Processing Time   â”‚ Histogram â”‚ Performance   â”‚
â”‚ Failed Events           â”‚ Counter   â”‚ Reliability   â”‚
â”‚ Ledger Entry Count      â”‚ Gauge     â”‚ Data Growth   â”‚
â”‚ Tax Calculations        â”‚ Counter   â”‚ Activity      â”‚
â”‚ Service Uptime          â”‚ Gauge     â”‚ Availability  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“ Key Takeaways

### Design Principles Demonstrated

1. **Loose Coupling**: Services communicate only through events
2. **High Cohesion**: Each service has a single, well-defined responsibility
3. **Scalability**: Services can be scaled independently
4. **Resilience**: Failure in one service doesn't crash the system
5. **Extensibility**: New services can be added without modifying existing ones

### Benefits Over Monolithic Design

```
Monolithic                     Microservices
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
One deployment                 â†’ Independent deployments
Tight coupling                 â†’ Loose coupling via events
Single point of failure        â†’ Fault isolation
Hard to scale                  â†’ Easy horizontal scaling
Technology lock-in             â†’ Technology flexibility
Complex testing                â†’ Independent testing
```

---

## ğŸš€ Future Enhancements

### Roadmap

```
Phase 1 (Current): âœ“ Prototype
â”œâ”€ Basic event-driven architecture
â”œâ”€ Three microservices
â””â”€ In-memory storage

Phase 2: Production-Ready
â”œâ”€ Add database persistence
â”œâ”€ Implement REST APIs
â”œâ”€ Add authentication/authorization
â””â”€ Deploy with Docker

Phase 3: Scalability
â”œâ”€ Replace event bus with Kafka
â”œâ”€ Add load balancers
â”œâ”€ Implement caching (Redis)
â””â”€ Horizontal scaling

Phase 4: Advanced Features
â”œâ”€ Add more services (Payment, Notification)
â”œâ”€ Implement CQRS pattern
â”œâ”€ Add distributed tracing
â””â”€ Kubernetes orchestration
```

---

**Document Version**: 1.0  
**Last Updated**: January 17, 2026  
**Maintained By**: Development Team
